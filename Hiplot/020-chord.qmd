---
title: "Chord Plot"
author:
  - "**[Editor]** [Hu Zheng](https://github.com/ZhengTiger);"
  - "**[Contributors]** [Benben Miao](https://github.com/benben-miao);"
---

::: callout-note
**Hiplot website**

This page is the tutorial for source code version of the Hiplot `Chord Plot` plugin. You can also use the Hiplot website to achieve no code ploting. For more information please see the following link:

<https://hiplot.cn/basic/chord?lang=en>
:::

A chord diagram is a chart that visualizes relationship networks between entities in matrix data. It uses nodal arcs and colored chords to intuitively represent connection directions and intensities, making it suitable for displaying both symmetric and asymmetric relational data, such as interactions between biological molecules or membership relationships between genes and biological functions. By varying the thickness of the chords, readers can quickly identify key connection patterns.

## Setup

-   System Requirements: Cross-platform (Linux/MacOS/Windows)

-   Programming language: R

-   Dependent packages: `data.table`; `jsonlite`; `circlize`; `ggplotify`

```{r packages setup, message=FALSE, warning=FALSE, output=FALSE}
# Install packages
if (!requireNamespace("data.table", quietly = TRUE)) {
  install.packages("data.table")
}
if (!requireNamespace("jsonlite", quietly = TRUE)) {
  install.packages("jsonlite")
}
if (!requireNamespace("circlize", quietly = TRUE)) {
  install.packages("circlize")
}
if (!requireNamespace("ggplotify", quietly = TRUE)) {
  install.packages("ggplotify")
}

# Library packages
library(data.table)
library(jsonlite)
library(circlize)
library(ggplotify)
```

## Data Preparation

Data frame or matrix of interaction of genes with pathways or gene ontologys.

```{r load data, message=FALSE, warning=FALSE}
# Load data
data <- data.table::fread(jsonlite::read_json("https://hiplot.cn/ui/basic/chord/data.json")$exampleData$textarea[[1]])
data <- as.data.frame(data)

# Mutation data
row.names(data) <- data[, 1]
data <- data[, -1]
data <- as.matrix(data)

# View data
head(data)
```

## Visualization

### 1. Symmetric Chord

```{r fig-1Chi-square-fisher}
#| label: fig-1SymmetricChord
#| fig-cap: "Symmetric Chord"
#| out.width: "95%"
#| warning: false
#| message: false
#| fig-height: 6
#| fig-width: 6

# Color Pallets
Palette <- c("#E64B35FF","#4DBBD5FF","#00A087FF","#3C5488FF","#F39B7FFF",
             "#8491B4FF","#91D1C2FF","#DC0000FF","#7E6148FF","#B09C85FF")
grid.col <- c(Palette, Palette, Palette[1:5])

# Chord Plot
p <- as.ggplot(function() {
  chordDiagram(
    data, 
    grid.col = grid.col,        # Set node colors
    grid.border = NULL,         # No node borders
    transparency = 0.5,         # 50% chord transparency
    row.col = NULL,             # Row colors (default)
    column.col = NULL,          # Column colors (default)  
    order = NULL,               # Node order (default)
    
    # Directionality settings
    directional = 0,            # 0=no direction, 1=forward, -1=backward, 2=bidirectional
    direction.type = "diffHeight", # Direction display type: "diffHeight" and "arrows"
    diffHeight = convert_height(2, "mm"), # Direction height difference
    
    # Layout parameters
    reduce = 1e-5,              # Minimum gap for small sectors
    xmax = NULL,                # Maximum x-coordinate (auto-calculated)
    self.link = 2,              # Self-link style: 1=single side, 2=double side
    symmetric = FALSE,          # Whether matrix is symmetric
    keep.diagonal = FALSE,      # Whether to keep diagonal
    
    # Track settings
    preAllocateTracks = NULL,   # Pre-allocated tracks
    annotationTrack = c("name", "grid", "axis"), # Display names, grid, and axes
    annotationTrackHeight = convert_height(c(3, 3), "mm"), # Track height
    
    # Link styling
    link.border = NA,           # Link border (none)
    link.lwd = par("lwd"),      # Link line width
    link.lty = par("lty"),      # Link line type
    link.sort = FALSE,          # Whether to sort links
    link.decreasing = TRUE,     # Link sorting order
    link.largest.ontop = FALSE, # Whether largest links are on top
    link.visible = TRUE,        # Whether links are visible
    link.rank = NULL,           # Link hierarchy
    link.overlap = FALSE,       # Whether links can overlap
    
    # Grouping and spacing
    scale = FALSE,              # Whether to scale chord widths
    group = NULL,               # Grouping settings
    big.gap = 10,               # Gap between major groups (degrees)
    small.gap = 1               # Gap within minor groups (degrees)
  )
})

p
```


### 2. Proportional Chord

```{r fig-1Chi-square-fisher}
#| label: fig-2ProportionalChord
#| fig-cap: "Proportional Chord"
#| out.width: "95%"
#| warning: false
#| message: false
#| fig-height: 6
#| fig-width: 6

# Color Pallets
Palette <- c("#E64B35FF","#4DBBD5FF","#00A087FF","#3C5488FF","#F39B7FFF",
             "#8491B4FF","#91D1C2FF","#DC0000FF","#7E6148FF","#B09C85FF")
grid.col <- c(Palette, Palette, Palette[1:5])

# Chord Plot
p <- as.ggplot(function() {
  chordDiagram(
    data, 
    grid.col = grid.col,        # Set node colors
    grid.border = NULL,         # No node borders
    transparency = 0.5,         # 50% chord transparency
    row.col = NULL,             # Row colors (default)
    column.col = NULL,          # Column colors (default)  
    order = NULL,               # Node order (default)
    
    # Directionality settings
    directional = 0,            # 0=no direction, 1=forward, -1=backward, 2=bidirectional
    direction.type = "diffHeight", # Direction display type: "diffHeight" and "arrows"
    diffHeight = convert_height(2, "mm"), # Direction height difference
    
    # Layout parameters
    reduce = 1e-5,              # Minimum gap for small sectors
    xmax = NULL,                # Maximum x-coordinate (auto-calculated)
    self.link = 2,              # Self-link style: 1=single side, 2=double side
    symmetric = FALSE,          # Whether matrix is symmetric
    keep.diagonal = FALSE,      # Whether to keep diagonal
    
    # Track settings
    preAllocateTracks = NULL,   # Pre-allocated tracks
    annotationTrack = c("name", "grid", "axis"), # Display names, grid, and axes
    annotationTrackHeight = convert_height(c(3, 3), "mm"), # Track height
    
    # Link styling
    link.border = NA,           # Link border (none)
    link.lwd = par("lwd"),      # Link line width
    link.lty = par("lty"),      # Link line type
    link.sort = FALSE,          # Whether to sort links
    link.decreasing = TRUE,     # Link sorting order
    link.largest.ontop = FALSE, # Whether largest links are on top
    link.visible = TRUE,        # Whether links are visible
    link.rank = NULL,           # Link hierarchy
    link.overlap = FALSE,       # Whether links can overlap
    
    # Grouping and spacing
    scale = TRUE,              # Whether to scale chord widths
    group = NULL,               # Grouping settings
    big.gap = 10,               # Gap between major groups (degrees)
    small.gap = 1               # Gap within minor groups (degrees)
  )
})

p
```